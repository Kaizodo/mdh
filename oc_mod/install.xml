<?xml version="1.0" encoding="utf-8"?>
<modification>
    <code>themevolty</code>
    <name>Themevolty</name>
    <version>3.x</version>
    <author>themevolty</author>
    
    <file path="admin/controller/extension/theme/default.php">
        <operation>
            <search><![CDATA[if (($this->request->server['REQUEST_METHOD'] == 'POST') && $this->validate()) {]]></search>
            <add position="after"><![CDATA[
                if($this->request->post['theme_default_directory'] == "opc_electronics_salora_2301"){
                        $file       = DIR_SYSTEM."framework.php";
                        $data         = "global \$registry;";
                        $filecontent  = file_get_contents($file);
                        $searchpos    = strpos($filecontent, 'global');
                        if(!empty($searchpos)){
                        }else{
                          $pos      = strpos($filecontent, '<?php');
                          $filecontent  = substr($filecontent, 0, 5)."\r\n".$data."\r\n".substr($filecontent, 5);
                          file_put_contents($file, $filecontent);
                        }
                      }
            ]]></add>
        </operation>      
    </file>
    <file path="admin/language/en-gb/design/layout.php">
        <operation>
            <search><![CDATA[$_['text_column_right']   = 'Column Right';]]></search>
            <add position="after"><![CDATA[$_['text_footer_top']    = 'Footer Top';]]></add>
        </operation>      
    </file>
    <file path="admin/view/template/design/layout_form.twig">
        <operation>
            <search><![CDATA[onclick="addModule('content-bottom');"]]></search>
            <add position="after" offset="5"><![CDATA[ <!-- footer  top -->
                 <table id="module-footer-top" class="table table-striped table-bordered table-hover">
                  <thead>
                    <tr>
                      <td class="text-center">{{ text_footer_top }}</td>
                    </tr>
                  </thead>
                  <tbody>
                    {% for layout_module in layout_modules %}
                    {% if layout_module.position == 'footer_top' %}
                    <tr id="module-row{{ module_row }}">
                      <td class="text-left"><div class="input-group">
                          <select name="layout_module[{{ module_row }}][code]" class="form-control input-sm">
                            {% for extension in extensions %}
                            <optgroup label="{{ extension.name }}">
                            {% if not extension.module %}
                            {% if extension.code == layout_module.code %}
                            <option value="{{ extension.code }}" selected="selected">{{ extension.name }}</option>
                            {% else %}
                            <option value="{{ extension.code }}">{{ extension.name }}</option>
                            {% endif %}
                            {% else %}
                            {% for module in extension.module %}
                            {% if module.code == layout_module.code %}
                            <option value="{{ module.code }}" selected="selected">{{ module.name }}</option>
                            {% else %}
                            <option value="{{ module.code }}">{{ module.name }}</option>
                            {% endif %}
                            {% endfor %}
                            {% endif %}
                            </optgroup>
                            {% endfor %}
                          </select>
                          <input type="hidden" name="layout_module[{{ module_row }}][position]" value="{{ layout_module.position }}" />
                          <input type="hidden" name="layout_module[{{ module_row }}][sort_order]" value="{{ layout_module.sort_order }}" />
                          <div class="input-group-btn"><a href="{{ layout_module.edit }}" type="button" data-toggle="tooltip" title="{{ button_edit }}" target="_blank" class="btn btn-primary btn-sm"><i class="fa fa-pencil"></i></a>
                            <button type="button" onclick="$('#module-row{{ module_row }}').remove();" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger btn-sm"><i class="fa fa fa-minus-circle"></i></button>
                          </div>
                        </div></td>
                    </tr>
                    {% set module_row = module_row + 1 %}
                    {% endif %}
                    {% endfor %}
                  </tbody>
                  <tfoot>
                    <tr>
                      <td class="text-left"><div class="input-group">
                          <select class="form-control input-sm">
                            <option value=""></option>
                            {% for extension in extensions %}
                            <optgroup label="{{ extension.name }}">
                            {% if not extension.module %}
                            <option value="{{ extension.code }}">{{ extension.name }}</option>
                            {% else %}
                            {% for module in extension.module %}
                            <option value="{{ module.code }}">{{ module.name }}</option>
                            {% endfor %}
                            {% endif %}
                            </optgroup>
                            {% endfor %}
                          </select>
                          <div class="input-group-btn">
                            <button type="button" onclick="addModule('footer-top');" data-toggle="tooltip" title="{{ button_module_add }}" class="btn btn-primary btn-sm"><i class="fa fa-plus-circle"></i></button>
                          </div>
                        </div></td>
                    </tr>
                  </tfoot>
                </table>
                <!-- end -->]]></add>
        </operation>
        <operation>
            <search><![CDATA[$('#module-column-left,]]></search>
            <add position="replace"><![CDATA[$('#module-column-left, #module-footer-top,]]></add>
        </operation>      
    </file>
    <file path="admin/language/en-gb/common/column_left.php">
        <operation>
            <search><![CDATA[$_['text_other_status']         = 'Other Statuses';]]></search>
            <add position="after"><![CDATA[$_['text_themevolty']             = 'ThemeVolty Extension';]]></add>
        </operation>      
    </file>
    <file path="admin/model/catalog/category.php">
        <operation>
            <search><![CDATA[public function getCategories($data = array()) {]]></search>
            <add position="before"><![CDATA[
                    public function getparentCategories($data = array()) {
                        $sql = "SELECT cp.category_id AS category_id, GROUP_CONCAT(cd1.name ORDER BY cp.level SEPARATOR '&nbsp;&nbsp;&gt;&nbsp;&nbsp;') AS name, c1.parent_id, c1.sort_order FROM " . DB_PREFIX . "category_path cp LEFT JOIN " . DB_PREFIX . "category c1 ON (cp.category_id = c1.category_id) LEFT JOIN " . DB_PREFIX . "category c2 ON (cp.path_id = c2.category_id) LEFT JOIN " . DB_PREFIX . "category_description cd1 ON (cp.path_id = cd1.category_id) LEFT JOIN " . DB_PREFIX . "category_description cd2 ON (cp.category_id = cd2.category_id) WHERE cd1.language_id = '" . (int)$this->config->get('config_language_id') . "' AND cd2.language_id = '" . (int)$this->config->get('config_language_id') . "' AND c1.parent_id = '0'";

                        if (!empty($data['filter_name'])) {
                            $sql .= " AND cd2.name LIKE '%" . $this->db->escape($data['filter_name']) . "%'";
                        }

                        $sql .= " GROUP BY cp.category_id";

                        $sort_data = array(
                            'name',
                            'sort_order'
                        );

                        if (isset($data['sort']) && in_array($data['sort'], $sort_data)) {
                            $sql .= " ORDER BY " . $data['sort'];
                        } else {
                            $sql .= " ORDER BY sort_order";
                        }

                        if (isset($data['order']) && ($data['order'] == 'DESC')) {
                            $sql .= " DESC";
                        } else {
                            $sql .= " ASC";
                        }

                        if (isset($data['start']) || isset($data['limit'])) {
                            if ($data['start'] < 0) {
                                $data['start'] = 0;
                            }

                            if ($data['limit'] < 1) {
                                $data['limit'] = 20;
                            }

                            $sql .= " LIMIT " . (int)$data['start'] . "," . (int)$data['limit'];
                        }

                        $query = $this->db->query($sql);

                        return $query->rows;
                    }
            ]]></add>
        </operation>      
    </file>
    <file path="admin/controller/common/column_left.php">
        <operation>
            <search><![CDATA[// Stats]]></search>
            <add position="before"><![CDATA[
                // themevolty
                if($this->config->get('theme_default_directory') == "opc_electronics_salora_2301"){
                    $themevolty = array();
                    
                    $this->load->model('catalog/tvcmsbrandlist');

                    $module_name = $this->model_catalog_tvcmsbrandlist->getmodulename();
                    $themevolty[] = array(
                                'name'     => 'Custom Setting',
                                'href'     => $this->url->link('extension/module/tvcmscustomsetting', 'user_token=' . $this->session->data['user_token'], true),
                                'children' => array()       
                            );
                    foreach ($module_name as $key => $value) {
                        if ($this->user->hasPermission('access', 'report/report')) {
                            $themevolty[] = array(
                                'name'     => $value['name'],
                                'href'     => $this->url->link('extension/module/'.$value['code'].'', 'user_token=' . $this->session->data['user_token'] . '&module_id=' . $value['module_id'], true),
                                'children' => array()       
                            );
                        }
                    }
                    $themevolty[] = array(
                        'name'     => "Comment List",
                        'href'     => $this->url->link('extension/module/tvcmscommentlist', 'user_token='. $this->session->data['user_token'] , true),
                        'children' => array()       
                    );
                    $themevolty[] = array(
                        'name'     => "News Letter List",
                        'href'     => $this->url->link('extension/module/tvcmsnewsletterlist', 'user_token='. $this->session->data['user_token'] , true),
                        'children' => array()       
                    );
                    $data['menus'][] = array(
                        'id'       => 'menu-themevolty',
                        'icon'     => 'fa-television',
                        'name'     => $this->language->get('text_themevolty'),
                        'href'     => '',
                        'children' => $themevolty
                    );
                }
            ]]></add>
        </operation>      
    </file>
    <file path="admin/controller/startup/startup.php">
        <operation>
            <search><![CDATA[// Cart]]></search>
            <add position="after"><![CDATA[// Themevolty Status
        $this->registry->set('Tvcmsthemevoltystatus', new Cart\tvcmsthemevoltystatus($this->registry));]]></add>
        </operation>      
    </file>
    <file path="catalog/controller/product/manufacturer.php">
        <operation>
            <search><![CDATA[if ($this->customer->isLogged() || !$this->config->get('config_customer_price')) {]]></search>
            <add position="before"><![CDATA[
                $data['comparedisplay']   =  $this->config->get('tvcmscustomsetting_configuration')['comparedisplay'];
                $data['wishlistdisplay']   = $this->config->get('tvcmscustomsetting_configuration')['wishlistdisplay'];
                $date = $this->model_catalog_product->getcustomProductSpecials($result['product_id']);
                if(isset($date['date_start'])){
                    $sdate = $date['date_start'];
                }else{
                    $sdate = "";
                }

                if(isset($date['date_end'])){
                    $edate = $date['date_end'];
                }else{
                    $edate = "";
                }
                if ($result['image']) {
                    $gridimage = $this->model_tool_image->resize($result['image'], $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_width'), $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_height'));
                } else {
                    $gridimage = $this->model_tool_image->resize('placeholder.png', $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_width'), $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_height'));
                }
            $gethoverimage   = $this->model_catalog_product->getproductimage($result['product_id']);

                if(!empty(current($gethoverimage))){
                    $hoverimage = $this->model_tool_image->resize(current($gethoverimage)['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_product_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_product_height'));
                    $gridhoverimage = $this->model_tool_image->resize(current($gethoverimage)['image'], $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_width'), $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_height'));
                }else{
                    $gridhoverimage = $gridimage;
                    $hoverimage = $image;
                }
                ]]></add>
        </operation>   
        <operation>
            <search><![CDATA['thumb'       => $image,]]></search>
            <add position="before"><![CDATA[
                'start_date' => $sdate,
                'date_end'   => $edate,
                'hoverimage' => $hoverimage,
                'gridimage' => $gridimage,
                'gridhoverimage' => $gridhoverimage,
                ]]></add>
        </operation>   
        <operation>
            <search><![CDATA[$product_total = $this->model_catalog_product->getTotalProducts($filter_data);]]></search>
            <add position="after"><![CDATA[
              $data['no_product'] = $product_total; 
              if(!empty($product_total)){
                    $data['category_data'] = "ttvcontent-full-width";
                }else{
                    $data['category_data'] = "";
                }    
            ]]></add>
        </operation>   
    </file>
    <file path="catalog/controller/product/special.php">
        <operation>
            <search><![CDATA[if ($this->customer->isLogged() || !$this->config->get('config_customer_price')) {]]></search>
            <add position="before"><![CDATA[
                $data['comparedisplay']   =  $this->config->get('tvcmscustomsetting_configuration')['comparedisplay'];
                $data['wishlistdisplay']   = $this->config->get('tvcmscustomsetting_configuration')['wishlistdisplay'];
                $date = $this->model_catalog_product->getcustomProductSpecials($result['product_id']);
                if(isset($date['date_start'])){
                    $sdate = $date['date_start'];
                }else{
                    $sdate = "";
                }

                if(isset($date['date_end'])){
                    $edate = $date['date_end'];
                }else{
                    $edate = "";
                }
                $gethoverimage   = $this->model_catalog_product->getproductimage($result['product_id']);
                if ($result['image']) {
                    $gridimage = $this->model_tool_image->resize($result['image'], $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_width'), $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_height'));
                } else {
                    $gridimage = $this->model_tool_image->resize('placeholder.png', $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_width'), $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_height'));
                }
                if(!empty(current($gethoverimage))){
                    $hoverimage = $this->model_tool_image->resize(current($gethoverimage)['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_product_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_product_height'));
                    $gridhoverimage = $this->model_tool_image->resize(current($gethoverimage)['image'], $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_width'), $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_height'));
                }else{
                    $hoverimage = $image;
                    $gridhoverimage = $gridimage;
                }
                ]]></add>
        </operation>   
        <operation>
            <search><![CDATA['thumb'       => $image,]]></search>
            <add position="before"><![CDATA[
                'start_date' => $sdate,
                'date_end'   => $edate,
                'hoverimage' => $hoverimage,
                'gridimage' => $gridimage,
                'gridhoverimage' => $gridhoverimage,
                ]]></add>
        </operation>   
        <operation>
            <search><![CDATA[$product_total = $this->model_catalog_product->getTotalProductSpecials()]]></search>
            <add position="after"><![CDATA[
              $data['no_product'] = $product_total; 
              if(!empty($product_total)){
                    $data['category_data'] = "ttvcontent-full-width";
                }else{
                    $data['category_data'] = "";
                }  
            ]]></add>
        </operation>   
    </file>
    <file path="catalog/controller/startup/startup.php">
        <operation>
            <search><![CDATA[// Cart]]></search>
            <add position="after"><![CDATA[// Themevolty Status
        $this->registry->set('Tvcmsthemevoltystatus', new Cart\tvcmsthemevoltystatus($this->registry));]]></add>
        </operation>      
    </file>
    <file path="catalog/controller/product/category.php">
        <operation>
            <search><![CDATA[if ($this->customer->isLogged() || !$this->config->get('config_customer_price')) {]]></search>
            <add position="before"><![CDATA[
                    $data['comparedisplay']   =  $this->config->get('tvcmscustomsetting_configuration')['comparedisplay'];
                $data['wishlistdisplay']   = $this->config->get('tvcmscustomsetting_configuration')['wishlistdisplay'];
                    $date = $this->model_catalog_product->getcustomProductSpecials($result['product_id']);
                    if(isset($date['date_start'])){
                        $sdate = $date['date_start'];
                    }else{
                        $sdate = "";
                    }

                    if(isset($date['date_end'])){
                        $edate = $date['date_end'];
                    }else{
                        $edate = "";
                    }
                    if ($result['image']) {
                        $gridimage = $this->model_tool_image->resize($result['image'], $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_width'), $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_height'));
                    } else {
                        $gridimage = $this->model_tool_image->resize('placeholder.png', $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_width'), $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_height'));
                    }

                    $gethoverimage   = $this->model_catalog_product->getproductimage($result['product_id']);

                    if(!empty(current($gethoverimage))){
                        $hoverimage = $this->model_tool_image->resize(current($gethoverimage)['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_product_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_product_height'));
                        $gridhoverimage = $this->model_tool_image->resize(current($gethoverimage)['image'], $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_width'), $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_height'));

                    }else{
                        $hoverimage = $image;
                        $gridhoverimage = $gridimage;
                    }
                ]]></add>
        </operation>   
        <operation>
            <search><![CDATA['thumb'       => $image,]]></search>
            <add position="before"><![CDATA[
                'start_date' => $sdate,
                'date_end'   => $edate,
                'hoverimage' => $hoverimage,
                'gridimage' => $gridimage,
                'gridhoverimage' => $gridhoverimage,
                ]]></add>
        </operation>
         <operation>
            <search><![CDATA[$results = $this->model_catalog_product->getProducts($filter_data)]]></search>
            <add position="after"><![CDATA[
                $data['no_product'] = $product_total;
                if(!empty($product_total)){
                    $data['category_data'] = "ttvcontent-full-width";
                }else{
                    $data['category_data'] = "";
                }

            ]]></add>
        </operation>      
    </file>

    
    <file path="catalog/controller/product/product.php">
        <operation>
            <search><![CDATA[if ((float)$result['special']) {]]></search>
            <add position="before"><![CDATA[
                $data['comparedisplay']   = $this->config->get('tvcmscustomsetting_configuration')['comparedisplay'];
                $data['wishlistdisplay']   = $this->config->get('tvcmscustomsetting_configuration')['wishlistdisplay'];
                $date = $this->model_catalog_product->getcustomProductSpecials($result['product_id']);
                if(isset($date['date_start'])){
                    $sdate = $date['date_start'];
                }else{
                    $sdate = "";
                }

                if(isset($date['date_end'])){
                    $edate = $date['date_end'];
                }else{
                    $edate = "";
                }
                $gethoverimage   = $this->model_catalog_product->getproductimage($result['product_id']);
                if(!empty(current($gethoverimage))){
                    $hoverimage = $this->model_tool_image->resize(current($gethoverimage)['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_product_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_product_height'));
                    
                }else{
                    $hoverimage = $image;
                }
                ]]></add>
        </operation>   
         <operation>
            <search><![CDATA['thumb'       => $image,]]></search>
            <add position="before"><![CDATA[
                'start_date' => $sdate,
                'date_end'   => $edate,
                'hoverimage' => $hoverimage,
            ]]></add>
        </operation>      
    </file>
    <file path="catalog/model/catalog/product.php">
        <operation>
            <search><![CDATA[class ModelCatalogProduct extends Model {]]></search>
            <add position="after"><![CDATA[
                 public function getproductimage($product_id) {
                    $query = $this->db->query("SELECT image FROM " . DB_PREFIX . "product_image WHERE product_id =  '" . (int)$product_id . "'");
                        return $query->rows;
                }
                public function getcategoryid($product_id) {
                    $query = $this->db->query("SELECT category_id FROM " . DB_PREFIX . "product_to_category WHERE product_id = '" . (int)$product_id . "'");
                    return $query->row['category_id'];
                }
                public function getcategoryname($category_id) {
                    $query = $this->db->query("SELECT name FROM " . DB_PREFIX . "category_description WHERE category_id = '" . (int)$category_id . "'");
                    return $query->row['name'];
                }
                public function getProductid($category_id) {
                    $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_to_category WHERE category_id IN (".$category_id.") GROUP BY product_id");
                    return $query->rows;
                }
                public function getcateid($category_id) {
                    $query = $this->db->query("SELECT category_id FROM " . DB_PREFIX . "category WHERE parent_id  in (".$category_id.")");      
                    return $query->rows;
                }
                public function getmoduledetail($module) {
                    $query = $this->db->query("SELECT setting FROM " . DB_PREFIX . "module WHERE code  = '".$module."'");       
                    return $query->row;
                }
                public function gettvtabproduct() {
                    $query = $this->db->query("SELECT DISTINCT *, pd.name AS name, p.image, m.name AS manufacturer, (SELECT price FROM " . DB_PREFIX . "product_discount pd2 WHERE pd2.product_id = p.product_id AND pd2.customer_group_id = '" . (int)$this->config->get('config_customer_group_id') . "' AND pd2.quantity = '1' AND ((pd2.date_start = '0000-00-00' OR pd2.date_start < NOW()) AND (pd2.date_end = '0000-00-00' OR pd2.date_end > NOW())) ORDER BY pd2.priority ASC, pd2.price ASC LIMIT 1) AS discount, (SELECT price FROM " . DB_PREFIX . "product_special ps WHERE ps.product_id = p.product_id AND ps.customer_group_id = '" . (int)$this->config->get('config_customer_group_id') . "' AND ((ps.date_start = '0000-00-00' OR ps.date_start < NOW()) AND (ps.date_end = '0000-00-00' OR ps.date_end > NOW())) ORDER BY ps.priority ASC, ps.price ASC LIMIT 1) AS special, (SELECT points FROM " . DB_PREFIX . "product_reward pr WHERE pr.product_id = p.product_id AND pr.customer_group_id = '" . (int)$this->config->get('config_customer_group_id') . "') AS reward, (SELECT ss.name FROM " . DB_PREFIX . "stock_status ss WHERE ss.stock_status_id = p.stock_status_id AND ss.language_id = '" . (int)$this->config->get('config_language_id') . "') AS stock_status, (SELECT wcd.unit FROM " . DB_PREFIX . "weight_class_description wcd WHERE p.weight_class_id = wcd.weight_class_id AND wcd.language_id = '" . (int)$this->config->get('config_language_id') . "') AS weight_class, (SELECT lcd.unit FROM " . DB_PREFIX . "length_class_description lcd WHERE p.length_class_id = lcd.length_class_id AND lcd.language_id = '" . (int)$this->config->get('config_language_id') . "') AS length_class, (SELECT AVG(rating) AS total FROM " . DB_PREFIX . "review r1 WHERE r1.product_id = p.product_id AND r1.status = '1' GROUP BY r1.product_id) AS rating, (SELECT COUNT(*) AS total FROM " . DB_PREFIX . "review r2 WHERE r2.product_id = p.product_id AND r2.status = '1' GROUP BY r2.product_id) AS reviews, p.sort_order FROM " . DB_PREFIX . "product p LEFT JOIN " . DB_PREFIX . "product_description pd ON (p.product_id = pd.product_id) LEFT JOIN " . DB_PREFIX . "product_to_store p2s ON (p.product_id = p2s.product_id) LEFT JOIN " . DB_PREFIX . "manufacturer m ON (p.manufacturer_id = m.manufacturer_id) WHERE pd.language_id = '" . (int)$this->config->get('config_language_id') . "' AND p.status = '1' AND p.date_available <= NOW() AND p2s.store_id = '" . (int)$this->config->get('config_store_id') . "'");
                    if ($query->num_rows) {
                        return array(
                            'product_id'       => $query->row['product_id'],
                            'name'             => $query->row['name'],
                            'description'      => $query->row['description'],
                            'meta_title'       => $query->row['meta_title'],
                            'meta_description' => $query->row['meta_description'],
                            'meta_keyword'     => $query->row['meta_keyword'],
                            'tag'              => $query->row['tag'],
                            'model'            => $query->row['model'],
                            'sku'              => $query->row['sku'],
                            'upc'              => $query->row['upc'],
                            'ean'              => $query->row['ean'],
                            'jan'              => $query->row['jan'],
                            'isbn'             => $query->row['isbn'],
                            'mpn'              => $query->row['mpn'],
                            'location'         => $query->row['location'],
                            'quantity'         => $query->row['quantity'],
                            'stock_status'     => $query->row['stock_status'],
                            'image'            => $query->row['image'],
                            'manufacturer_id'  => $query->row['manufacturer_id'],
                            'manufacturer'     => $query->row['manufacturer'],
                            'price'            => ($query->row['discount'] ? $query->row['discount'] : $query->row['price']),
                            'special'          => $query->row['special'],
                            'reward'           => $query->row['reward'],
                            'points'           => $query->row['points'],
                            'tax_class_id'     => $query->row['tax_class_id'],
                            'date_available'   => $query->row['date_available'],
                            'weight'           => $query->row['weight'],
                            'weight_class_id'  => $query->row['weight_class_id'],
                            'length'           => $query->row['length'],
                            'width'            => $query->row['width'],
                            'height'           => $query->row['height'],
                            'length_class_id'  => $query->row['length_class_id'],
                            'subtract'         => $query->row['subtract'],
                            'rating'           => round($query->row['rating']),
                            'reviews'          => $query->row['reviews'] ? $query->row['reviews'] : 0,
                            'minimum'          => $query->row['minimum'],
                            'sort_order'       => $query->row['sort_order'],
                            'status'           => $query->row['status'],
                            'date_added'       => $query->row['date_added'],
                            'date_modified'    => $query->row['date_modified'],
                            'viewed'           => $query->row['viewed']
                        );
                    } else {
                        return false;
                    }
                }
                public function getcustomProductSpecials($product_id) {
                    $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_special WHERE product_id = '".$product_id."' ");
                    return $query->row;
                }
            ]]></add>
        </operation>      
    </file>
    <file path="catalog/controller/common/currency.php">
        <operation>
            <search><![CDATA[$data['currencies'] = array();]]></search>
            <add position="before"><![CDATA[
                            $data['config_car_id'] = $this->session->data['currency'];
                ]]></add>
        </operation>      
    </file>
    <file path="catalog/controller/common/language.php">
        <operation>
            <search><![CDATA[$data['languages'] = array();]]></search>
            <add position="before"><![CDATA[
                    $lan =  $this->model_localisation_language->getLanguage($this->config->get('config_language_id'));
                    $data['confid_l_id'] = $lan['name'];
                ]]></add>
        </operation>      
    </file>
    <file path="catalog/controller/common/footer.php">
        <operation>
            <search><![CDATA[$data['contact']]]></search>
            <add position="before"><![CDATA[
                if($this->config->get('theme_default_directory') == "opc_electronics_salora_2301"){
                    $this->load->language('extension/module/tvcmscustomtext');
                    $data['newsletter']                     = $this->load->controller('common/tvcmsnewsletter');
                    $data['footerlogo']                     = $this->load->controller('common/tvcmsfooterlogo');
                    $data['store']                          = $this->config->get('config_name');
                    $data['address']                        = nl2br($this->config->get('config_address'));
                    $data['telephone']                      = $this->config->get('config_telephone');
                    $data['fax']                            = $this->config->get('config_fax');
                    $data['email']                          = $this->config->get('config_email');
                    $data['tvtags']                         = $this->load->controller('common/tvcmstags');
                    $sql                                    = $this->db->query("SELECT * FROM " . DB_PREFIX . "country WHERE country_id = '" . $this->config->get('config_country_id') . "' ");
                    $data['country_name']                   = $sql->row['name'];
                    $data['map']                            = $this->load->controller('common/tvcmsmap');
                    $data['socialicon']                     = $this->load->controller('common/tvcmssocialicon');
                    $data['paymenticon']                    = $this->load->controller('common/tvcmspaymenticon');
                    $store_time                             = $this->load->controller('common/tvcmsstoretime');
                    $data['tvcmsstoretime_status']          = $store_time['tvcmsstoretime_status'];
                    $data['tvcmsstoretime_monday_friday']   = $store_time['tvcmsstoretime_monday_friday'];
                    $data['tvcmsstoretime_saterday']        = $store_time['tvcmsstoretime_saterday'];
                    $data['tvcmsstoretime_sunday']          = $store_time['tvcmsstoretime_sunday'];
                    $data['tvcmsstoretime_title']           = $store_time['tvcmsstoretime_title'];
                    $data['tvcmsstoretime_information']     = $store_time['tvcmsstoretime_information'];
                     $data['tvcmscustomsetting_theme_css_path']     = $this->config->get('tvcmscustomsetting_theme_css_path');
                    $data['theme_option_status']            = $this->config->get('tvcmscustomsetting_configuration')['themeoptionstatus'];
                    $customsetting                          = $this->load->controller('common/tvcmscustomsetting');
                    $data['customsetting_status']           = $customsetting['status'];
                    $data['customsetting_customtext']       = $customsetting['customsub_text'];
                    $data['customsetting_customtextlink']   = $customsetting['customsub_textlink'];
                    //$data['appsphoto1']                     = $customsetting['appsub_img1'];
                    //$data['appsphoto2']                     = $customsetting['appsub_img2'];
                    //$data['appsphoto3']                     = $customsetting['appsub_img3'];
                    //$data['apple_link']                     = $customsetting['apple_link'];
                    //$data['google_link']                    = $customsetting['google_link'];
                   // $data['micro_link']                     = $customsetting['micro_link'];
                    if ($this->customer->isLogged()) {
                        $this->load->model('account/wishlist');
                        $data['text_wishlist_tv']   = sprintf($this->model_account_wishlist->getTotalWishlist());
                    } else {
                        $data['text_wishlist_tv']   = sprintf((isset($this->session->data['wishlist']) ? count($this->session->data['wishlist']) : 0));
                    }
                    $data['ttvcpmpare']             = $this->url->link('product/compare', '', true);
                    if(!empty($this->session->data['compare'])){
                        $data['ttvcpmpare_count']   = count($this->session->data['compare']);
                    }else{
                        $data['ttvcpmpare_count']   = 0;
                    }
                    $data['text_compare']       = $this->language->get('text_compare');
                    $data['text_wishlist']      = $this->language->get('text_wishlist');
                    $data['text_mycart']        = $this->language->get('text_mycart');
                    $data['text_myaccount']     = $this->language->get('text_myaccount');
                    $data['text_scrolltop']     = $this->language->get('text_scrolltop');
                    $data['text_storeinfo']     = $this->language->get('text_storeinfo');
                    $data['text_youraccount']   = $this->language->get('text_youraccount');
                    $data['text_ourcompany']    = $this->language->get('text_ourcompany');
                    $data['link_wishlist']      = $this->url->link('account/wishlist', '', true);
                    $data['link_compare']       = $this->url->link('product/compare', '', true);
                    $data['link_account']       = $this->url->link('account/account', '', true);
                    $data['link_addcart']       = $this->url->link('checkout/cart', '', true);
                }
                ]]></add>
        </operation>      
    </file>
    <file path="catalog/controller/common/header.php">
        <operation>
            <search><![CDATA[if ($this->customer->isLogged()) {]]></search>
            <add position="before"><![CDATA[
                 if($this->config->get('theme_default_directory') == "opc_electronics_salora_2301"){
                    $language_id = $this->config->get('config_language_id');
                    $this->load->language('extension/module/tvcmscustomtext');
                    $data['tv_lang_search_label']       = $this->language->get('tv_lang_search_label');
                    $data['tv_lang_search_text_label']  = $this->language->get('tv_lang_search_text_label');
                    $data['tv_lang_removecart_label']   = $this->language->get('tv_lang_removecart_label');
                    $data['tv_lang_subtottal_label']    = $this->language->get('tv_lang_subtottal_label');
                    $data['tv_lang_shipping_label']     = $this->language->get('tv_lang_shipping_label');
                    $data['tv_lang_tax_label']          = $this->language->get('tv_lang_tax_label');
                    $data['tv_lang_total_label']        = $this->language->get('tv_lang_total_label');
                    $data['tv_lang_checkout_label']     = $this->language->get('tv_lang_checkout_label');
                    $data['boxlayout']                  = $this->config->get('tvcmscustomsetting_configuration')['boxlayout'];
                    $data['loader_img']                 = $server."image/catalog/themevolty/pageloader/ttv_loading.gif";
                    $data['tvcmscustomsetting_background_style_sheet']            = $this->config->get('tvcmscustomsetting_background_style_sheet');
                    $data['theme_option_status']        = $this->config->get('tvcmscustomsetting_configuration')['themeoptionstatus'];
                    
                    if(!empty($this->session->data['compare'])){
                        $data['ttvcpmpare_count']   = count($this->session->data['compare']);
                    }else{
                        $data['ttvcpmpare_count']   = 0;
                    }
                    $data['mousehoverimage']            = $this->load->controller('common/tvcmscustomsetting')['mousehoverimage'];
                    $data['pageloader']                 = $this->load->controller('common/tvcmscustomsetting')['pageloader'];
                    $data['mainmenustickystatus']       = $this->load->controller('common/tvcmscustomsetting')['mainmenustickystatus'];
                    $data['custom_text']        = $this->config->get('tvcmscustomsetting_customsub')['lang_text'][$language_id]['customtext'];
                    $data['themeoption']                = $this->load->controller('common/tvcmscustomsthemeoption');
                    $data['text_support']               = $this->language->get('text_support');
                    if(empty($_SERVER['QUERY_STRING']) || $_SERVER['QUERY_STRING'] == "route=common/home"){
                        $data['homeid'] = "index";
                        $data['header1'] = 0;
                    }else{
                        $data['homeid'] = "";
                        $data['header1'] = "ttvcmsposition-block"; 
                    }
                    if(!empty($this->session->data['customer_id'])){
                        $data['logincust'] = $this->session->data['customer_id'];
                    }else{
                        $data['logincust'] = 0;
                    }
                }

                ]]></add>
        </operation>    
        <operation>
            <search><![CDATA[$this->load->model('account/wishlist');]]></search>
            <add position="after"><![CDATA[
                   $data['text_wishlist_tv'] = sprintf($this->model_account_wishlist->getTotalWishlist());
                ]]></add>
        </operation> 
        <operation>
            <search><![CDATA[(isset($this->session->data['wishlist']) ? count($this->session->data['wishlist']) : 0));]]></search>
            <add position="after"><![CDATA[
                  $data['text_wishlist_tv'] = sprintf((isset($this->session->data['wishlist']) ? count($this->session->data['wishlist']) : 0));
                ]]></add>
        </operation> 
         
    </file>
    <file path="catalog/controller/common/cart.php">
        <operation>
            <search><![CDATA[$this->load->model('tool/image');]]></search>
            <add position="before"><![CDATA[
                    $data['ttv_text_items'] = sprintf($this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0), $this->currency->format($total, $this->session->data['currency']));
                ]]></add>
        </operation>      
    </file>
    <file path="catalog/controller/common/menu.php">
        <operation>
            <search><![CDATA[$this->load->model('catalog/product');]]></search>
            <add position="before"><![CDATA[
                $this->load->language('extension/module/tvcmscustomtext');
                if (isset($this->request->get['path'])) {
                    $parts = explode('_', (string)$this->request->get['path']);
                } else {
                    $parts = array();
                }

                if (isset($parts[0])) {
                    $data['category_id'] = $parts[0];
                } else {
                    $data['category_id'] = 0;
                }
                if(empty($_SERVER['QUERY_STRING']) || $_SERVER['QUERY_STRING'] == "route=common/home"){
                    $data['menuhomeactive'] = "current";
                }else{
                    $data['menuhomeactive'] = "";
                }
                $this->load->model('account/wishlist');
                if ($this->customer->isLogged()) {
                    $this->load->model('account/wishlist');

                    $data['text_wishlist_tv']   = sprintf($this->model_account_wishlist->getTotalWishlist());
                } else {
                    $data['text_wishlist_tv']   = sprintf((isset($this->session->data['wishlist']) ? count($this->session->data['wishlist']) : 0));
                }

                $data['ttvcpmpare']             = $this->url->link('product/compare', '', true);

                if(!empty($this->session->data['compare'])){
                    $data['ttvcpmpare_count']   = count($this->session->data['compare']);
                }else{
                    $data['ttvcpmpare_count']   = 0;
                }
                ]]></add>
        </operation>  
        <operation>
            <search><![CDATA['name'     => $category['name'],]]></search>
            <add position="after"><![CDATA[
                'category_id'     => $category['category_id'],
                ]]></add>
        </operation>      
    </file>
    <file path="catalog/controller/product/compare.php">
        <operation>
            <search><![CDATA[if ($product_info['image']) {]]></search>
            <add position="after"><![CDATA[
                    $compareimage = $this->model_tool_image->resize($product_info['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_compare_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_compare_height'));
                ]]></add>
        </operation>
        <operation>
            <search><![CDATA[if ($this->customer->isLogged() || !$this->config->get('config_customer_price')) {]]></search>
            <add position="before"><![CDATA[
                        $gethoverimage   = $this->model_catalog_product->getproductimage($product_info['product_id']);

                        if(!empty(current($gethoverimage))){
                            $hoverimage = $this->model_tool_image->resize(current($gethoverimage)['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_compare_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_compare_height'));
                        }else{
                            $hoverimage = $compareimage;
                        }
                ]]></add>
        </operation>
        <operation>
            <search><![CDATA['thumb'        => $image,]]></search>
            <add position="after"><![CDATA[
                    'compare_thumb' => $compareimage,
                    'hoverimage'    => $hoverimage,
                ]]></add>
        </operation>
        <operation>
            <search><![CDATA[$this->load->model('tool/image');]]></search>
            <add position="after"><![CDATA[
                $this->load->language('extension/module/tvcmscustomtext');
                $data['text_productcompater'] = $this->language->get('text_productcompater');
            ]]></add>
        </operation>      
    </file>
    <file path="catalog/controller/common/search.php">
        <operation>
            <search><![CDATA[class ControllerCommonSearch extends Controller {]]></search>
            <add position="after"><![CDATA[
                    public function autocomplete() {
                        $json = array();

                        if (isset($this->request->get['filter_name'])) {

                            $this->load->model('catalog/tvcmsmodule');
                            $this->load->model('tool/image');
                            
                            if (isset($this->request->get['filter_name'])) {
                                $filter_name = $this->request->get['filter_name'];
                            } else {
                                $filter_name = '';
                            }

                            $limit = $this->config->get('tvcmscustomsetting_configuration')['searchlimit'];

                            $filter_data = array(
                                'filter_name'  => $filter_name,
                                'start'        => 0,
                                'limit'        => $limit
                            );
                            $html       = '';
                            $alldataget = $this->model_catalog_tvcmsmodule->getProducts($filter_data);
                            $results = $alldataget->rows;
                            $html .=    '<div class=\'ttvcmssearch-dropdown\'>';

                            $html .=    '<div class=\'ttvsearch-dropdown-close-wrapper\'>
                                            <div class=\'ttvsearch-dropdown-close\'>Close</div>
                                        </div>';
                            if (!empty($results)) {
                                
                                foreach ($results as $result) {                            
                                    $prod_price      = $this->currency->format($this->tax->calculate($result['price'], $result['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']);
                                    
                                    $special    = $this->currency->format($this->tax->calculate($result['special'], $result['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']);
                                    
                                    $tax        = $this->currency->format((float)$result['special'] ? $result['special'] : $result['price'], $this->session->data['currency']);

                                    $prod_link = $this->url->link('product/product', 'product_id=' . $result['product_id']);
                                    $prod_img = $this->model_tool_image->resize($result['image'],98,98);
                                    $prod_name = strip_tags(html_entity_decode($result['name'], ENT_QUOTES, 'UTF-8'));

                                    $html .= '
                                            <div class=\'ttvsearch-all-dropdown-wrapper\'>
                                                <div class=\'ttvsearch-dropdown-wrapper\'>
                                                    <a href=\''.$prod_link.'\'>
                                                        <div class=\'ttvsearch-dropdown-img-block\'>
                                                            <img src=\''.$prod_img.'\' alt=\''.$prod_name.'\' />
                                                        </div>
                                                        <div class=\'ttvsearch-dropdown-content-box\'>
                                                            <div class=\'ttvsearch-dropdown-title\'>'.$prod_name.'</div>
                                                            <div class=\'product-price-and-shipping\'>
                                                                <span class=\'regular-price\'>$18.90</span>
                                                                <span class=\'price\'>'.$prod_price.'</span>
                                                            </div>
                                                        </div>
                                                    </a>
                                                </div>
                                            </div>
                                            ';  
                                }
                                $html .=    '<div class=\'ttvsearch-more-search-wrapper\'>
                                                <div class=\'ttvsearch-more-search\'>More Result</div>
                                            </div>';
                            }else{
                                $html .= '<div class=\'ttvsearch-dropdown-wrapper\'>No product Found</div>';
                            }
                            $html .= '</div>';
                        }

                        if (!empty($html)) {
                            print_r($html);
                        }
                    }
                ]]></add>
        </operation>      
    </file>
    <file path="catalog/controller/product/search.php">                            
        <operation>
            <search><![CDATA[if ($this->customer->isLogged() || !$this->config->get('config_customer_price')) {]]></search>
            <add position="before"><![CDATA[
                $data['comparedisplay']   =  $this->config->get('tvcmscustomsetting_configuration')['comparedisplay'];
                $data['wishlistdisplay']   = $this->config->get('tvcmscustomsetting_configuration')['wishlistdisplay'];
                $date = $this->model_catalog_product->getcustomProductSpecials($result['product_id']);
                    if(isset($date['date_start'])){
                        $sdate = $date['date_start'];
                    }else{
                        $sdate = "";
                    }

                    if(isset($date['date_end'])){
                        $edate = $date['date_end'];
                    }else{
                        $edate = "";
                    }
                    if ($result['image']) {
                        $gridimage = $this->model_tool_image->resize($result['image'], $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_width'), $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_height'));
                    } else {
                        $gridimage = $this->model_tool_image->resize('placeholder.png', $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_width'), $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_height'));
                    }
                    $gethoverimage   = $this->model_catalog_product->getproductimage($result['product_id']);

                    if(!empty(current($gethoverimage))){
                        $hoverimage = $this->model_tool_image->resize(current($gethoverimage)['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_product_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_product_height'));
                        $gridhoverimage = $this->model_tool_image->resize(current($gethoverimage)['image'], $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_width'), $this->config->get('tvcmscustomsetting_tvcmsproductgridimg_img_height'));
                    }else{
                        $hoverimage = $image;
                        $gridhoverimage = $gridimage;
                    }

                ]]></add>
        </operation>
        <operation>
            <search><![CDATA['thumb'       => $image,]]></search>
            <add position="after"><![CDATA[
                    'start_date'     => $sdate,
                    'date_end'       => $edate,
                    'hoverimage'     => $hoverimage,
                    'gridimage'      => $gridimage,
                    'gridhoverimage' => $gridhoverimage,
                ]]></add>
        </operation>
        <operation>
            <search><![CDATA[$product_total = $this->model_catalog_product->getTotalProducts($filter_data);]]></search>
            <add position="after"><![CDATA[
                $data['no_product'] = $product_total;   
                if(!empty($product_total)){
                    $data['category_data'] = "ttvcontent-full-width";
                }else{
                    $data['category_data'] = "";
                } 
            ]]></add>
        </operation>
    </file>

    <file path="catalog/controller/extension/module/latest.php">
        <operation>
            <search><![CDATA[if ($this->customer->isLogged() || !$this->config->get('config_customer_price')) {]]></search>
            <add position="before"><![CDATA[
                $data['comparedisplay']   =  $this->config->get('tvcmscustomsetting_configuration')['comparedisplay'];
                $data['wishlistdisplay']   = $this->config->get('tvcmscustomsetting_configuration')['wishlistdisplay'];
                $date = $this->model_catalog_product->getcustomProductSpecials($result['product_id']);
                    if(isset($date['date_start'])){
                        $sdate = $date['date_start'];
                    }else{
                        $sdate = "";
                    }

                    if(isset($date['date_end'])){
                        $edate = $date['date_end'];
                    }else{
                        $edate = "";
                    }
                    
                    $gethoverimage   = $this->model_catalog_product->getproductimage($result['product_id']);

                    if(!empty(current($gethoverimage))){
                        $hoverimage = $this->model_tool_image->resize(current($gethoverimage)['image'], $setting['width'], $setting['height']);

                    }else{
                        $hoverimage = $image;
                    }
                ]]></add>
        </operation>   
        <operation>
            <search><![CDATA['thumb'       => $image,]]></search>
            <add position="before"><![CDATA[
                'start_date' => $sdate,
                'date_end'   => $edate,
                'hoverimage' => $hoverimage,
                ]]></add>
        </operation> 
        <operation>
            <search><![CDATA[public function index($setting) {]]></search>
            <add position="before"><![CDATA[
                protected function status(){
                    return $this->Tvcmsthemevoltystatus->tabproductstatus();
                }            
            ]]></add>
        </operation> 
        <operation>
            <search><![CDATA[if ($results) {]]></search>
            <add position="before"><![CDATA[
                if($this->config->get('theme_default_directory') == "opc_electronics_salora_2301"){
                    $this->load->model('catalog/tvcmsmodule');
                    $status                                         = $this->status();
                    $data['status_new_main_form']                   = $status['new_prod']['main_form'];
                    $data['status_new_home_title']                  = $status['new_prod']['home_title'];
                    $data['status_new_home_sub_title']              = $status['new_prod']['home_sub_title'];
                    $data['status_new_home_description']            = $status['new_prod']['home_description'];
                    $data['status_new_home_image']                  = $status['new_prod']['home_image'];
                    $data['lang_id']                                = $this->config->get('config_language_id');
                    if(!empty($data['status_new_main_form'])){
                        $name           = "tvcmstabproducts";
                        $status_info    = $this->model_catalog_tvcmsmodule->getmoduelstatus($name);
                        $data_info      = json_decode($status_info['setting'],1);
                        
                        if(!empty($data['status_new_home_title'])){
                            $data['new_hometitle'] = $data_info['tvcmstabproducts_pro_new']['lang_text'][$data['lang_id']]['hometitle'];
                        }
                        if(!empty($data['status_new_home_sub_title'])){
                            $data['new_homesubtitle'] = $data_info['tvcmstabproducts_pro_new']['lang_text'][$data['lang_id']]['homesubtitle'];
                        }
                        if(!empty($data['status_new_home_description'])){
                            $data['new_homedes'] = $data_info['tvcmstabproducts_pro_new']['lang_text'][$data['lang_id']]['homedes'];
                        }
                        if(!empty($data['status_new_home_image'])){
                            $data['new_img'] = $data_info['tvcmstabproducts_pro_new']['lang_text'][$data['lang_id']]['img'];
                        }   
                    }
                }
                ]]></add>
        </operation>     
    </file>
    <file path="catalog/controller/extension/module/featured.php">
        <operation>
            <search><![CDATA[if ($this->customer->isLogged() || !$this->config->get('config_customer_price')) {]]></search>
            <add position="before"><![CDATA[
                    $data['comparedisplay']   =  $this->config->get('tvcmscustomsetting_configuration')['comparedisplay'];
                    $data['wishlistdisplay']   = $this->config->get('tvcmscustomsetting_configuration')['wishlistdisplay'];
                    $date = $this->model_catalog_product->getcustomProductSpecials($product_info['product_id']);
                    if(isset($date['date_start'])){
                        $sdate = $date['date_start'];
                    }else{
                        $sdate = "";
                    }

                    if(isset($date['date_end'])){
                        $edate = $date['date_end'];
                    }else{
                        $edate = "";
                    }

                     $gethoverimage   = $this->model_catalog_product->getproductimage($product_info['product_id']);

                        if(!empty(current($gethoverimage))){
                            $hoverimage = $this->model_tool_image->resize(current($gethoverimage)['image'], $setting['width'], $setting['height']);

                            
                        }else{
                            $hoverimage = $image;
                        }
                ]]></add>
        </operation>   
         <operation>
            <search><![CDATA['thumb'       => $image,]]></search>
            <add position="before"><![CDATA[
                                         'hoverimage'    => $hoverimage,
                                         'start_date'   => $sdate,
                        'date_end'      => $edate,
                ]]></add>
        </operation>  
        <operation>
            <search><![CDATA[public function index($setting) {]]></search>
            <add position="before"><![CDATA[
                protected function status(){
                    return $this->Tvcmsthemevoltystatus->tabproductstatus();
                }            
            ]]></add>
        </operation> 
         <operation>
            <search><![CDATA[public function index($setting) {]]></search>
            <add position="after"><![CDATA[
                if($this->config->get('theme_default_directory') == "opc_electronics_salora_2301"){
                    $this->load->model('catalog/tvcmsmodule');
                    $status                                         = $this->status();
                    $data['status_featured_main_form']              = $status['featured_prod']['main_form'];
                    $data['status_featured_display_in_tab']         = $status['featured_prod']['display_in_tab'];
                    $data['status_featured_home_title']             = $status['featured_prod']['home_title'];
                    $data['status_featured_home_sub_title']         = $status['featured_prod']['home_sub_title'];
                    $data['status_featured_home_description']       = $status['featured_prod']['home_description'];
                    $data['status_featured_home_image']             = $status['featured_prod']['home_image'];
                    $data['lang_id']                                = $this->config->get('config_language_id');
                    $name                                           = "tvcmstabproducts";
                    $status_info                                    = $this->model_catalog_tvcmsmodule->getmoduelstatus($name);
                    $data_info                                      = json_decode($status_info['setting'],1);

                    if(!empty($data['status_featured_main_form'])){
                        if(!empty($data['status_featured_home_title'])){
                            $data['featured_home_title'] = $data_info['tvcmstabproducts_pro_fea']['lang_text'][$data['lang_id']]['hometitle'];
                        }
                        if(!empty($data['status_featured_home_sub_title'])){
                            $data['featured_home_sub_title'] = $data_info['tvcmstabproducts_pro_fea']['lang_text'][$data['lang_id']]['homesubtitle'];
                        }
                        if(!empty($data['status_featured_home_description'])){
                            $data['featured_home_description'] = $data_info['tvcmstabproducts_pro_fea']['lang_text'][$data['lang_id']]['homedes'];
                        }
                        if(!empty($data['status_featured_home_image'])){
                            $data['featured_home_image'] = $data_info['tvcmstabproducts_pro_fea']['lang_text'][$data['lang_id']]['img'];
                        }
                    }
                }
                ]]></add>
        </operation>     
    </file>
    <file path="catalog/controller/extension/module/bestseller.php">
        <operation>
            <search><![CDATA[if ($this->customer->isLogged() || !$this->config->get('config_customer_price')) {]]></search>
            <add position="before"><![CDATA[
                    $data['comparedisplay']   =  $this->config->get('tvcmscustomsetting_configuration')['comparedisplay'];
                    $data['wishlistdisplay']   = $this->config->get('tvcmscustomsetting_configuration')['wishlistdisplay'];
                    $date = $this->model_catalog_product->getcustomProductSpecials($result['product_id']);
                    if(isset($date['date_start'])){
                        $sdate = $date['date_start'];
                    }else{
                        $sdate = "";
                    }

                    if(isset($date['date_end'])){
                        $edate = $date['date_end'];
                    }else{
                        $edate = "";
                    }

                     $gethoverimage   = $this->model_catalog_product->getproductimage($result['product_id']);

                        if(!empty(current($gethoverimage))){
                            $hoverimage = $this->model_tool_image->resize(current($gethoverimage)['image'], $setting['width'], $setting['height']);

                            
                        }else{
                            $hoverimage = $image;
                        }
                ]]></add>
        </operation>   
         <operation>
            <search><![CDATA['thumb'       => $image,]]></search>
            <add position="before"><![CDATA[
                    'hoverimage'    => $hoverimage,
                    'start_date'    => $sdate,
                    'date_end'      => $edate,
                ]]></add>
        </operation>    
        <operation>
            <search><![CDATA[public function index($setting) {]]></search>
            <add position="before"><![CDATA[
                protected function status(){
                    return $this->Tvcmsthemevoltystatus->tabproductstatus();
                }            
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[if ($results) {]]></search>
            <add position="before"><![CDATA[
                if($this->config->get('theme_default_directory') == "opc_electronics_salora_2301"){
                    $this->load->model('catalog/tvcmsmodule');
                    $status                                         = $this->status();
                    $data['status_best_main_form']                  = $status['best_seller_prod']['main_form'];
                    $data['status_best_home_title']                 = $status['best_seller_prod']['home_title'];
                    $data['status_best_home_sub_title']             = $status['best_seller_prod']['home_sub_title'];
                    $data['status_best_home_description']           = $status['best_seller_prod']['home_description'];
                    $data['status_best_home_image']                 = $status['best_seller_prod']['home_image'];

                    $data['lang_id']                                = $this->config->get('config_language_id');
                    if(!empty($data['status_best_main_form'])){
                        $name           = "tvcmstabproducts";
                        $status_info    = $this->model_catalog_tvcmsmodule->getmoduelstatus($name);
                        $data_info      = json_decode($status_info['setting'],1);
                        
                        if(!empty($data['status_best_home_title'])){
                            $data['best_hometitle'] = $data_info['tvcmstabproducts_pro_best']['lang_text'][$data['lang_id']]['hometitle'];
                        }
                        if(!empty($data['status_best_home_sub_title'])){
                            $data['best_homesubtitle'] = $data_info['tvcmstabproducts_pro_best']['lang_text'][$data['lang_id']]['homesubtitle'];
                        }
                        if(!empty($data['status_best_home_description'])){
                            $data['best_homedes'] = $data_info['tvcmstabproducts_pro_best']['lang_text'][$data['lang_id']]['homedes'];
                        }
                        if(!empty($data['status_best_home_image'])){
                            $data['best_img'] = $data_info['tvcmstabproducts_pro_new']['lang_text'][$data['lang_id']]['img'];
                        }   
                    }
                }
                ]]></add>
        </operation>        
    </file>
    <file path="catalog/controller/extension/module/special.php">
        <operation>
            <search><![CDATA[if ($this->customer->isLogged() || !$this->config->get('config_customer_price')) {]]></search>
            <add position="before"><![CDATA[
                    $data['comparedisplay']   =  $this->config->get('tvcmscustomsetting_configuration')['comparedisplay'];
                    $data['wishlistdisplay']   = $this->config->get('tvcmscustomsetting_configuration')['wishlistdisplay'];
                    $date = $this->model_catalog_product->getcustomProductSpecials($result['product_id']);
                    if(isset($date['date_start'])){
                        $sdate = $date['date_start'];
                    }else{
                        $sdate = "";
                    }

                    if(isset($date['date_end'])){
                        $edate = $date['date_end'];
                    }else{
                        $edate = "";
                    }

                     $gethoverimage   = $this->model_catalog_product->getproductimage($result['product_id']);

                        if(!empty(current($gethoverimage))){
                            $hoverimage = $this->model_tool_image->resize(current($gethoverimage)['image'], $setting['width'], $setting['height']);

                            
                        }else{
                            $hoverimage = $image;
                        }
                ]]></add>
        </operation>   
        <operation>
            <search><![CDATA['thumb'       => $image,]]></search>
            <add position="before"><![CDATA[
                                         'hoverimage'    => $hoverimage,
                                          'start_date'      => $sdate,
                        'date_end'      => $edate,
                ]]></add>
        </operation> 
        <operation>
            <search><![CDATA[public function index($setting) {]]></search>
            <add position="before"><![CDATA[
                protected function status(){
                    return $this->Tvcmsthemevoltystatus->tabproductstatus();
                }            
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[if ($results) {]]></search>
            <add position="before"><![CDATA[
                if($this->config->get('theme_default_directory') == "opc_electronics_salora_2301"){
                    $this->load->model('catalog/tvcmsmodule');
                    $status                                         = $this->status();
                    $data['status_special_main_form']               = $status['special_prod']['main_form'];
                    $data['status_special_home_title']              = $status['special_prod']['home_title'];
                    $data['status_special_home_sub_title']          = $status['special_prod']['home_sub_title'];
                    $data['status_special_home_description']        = $status['special_prod']['home_description'];
                    $data['status_special_home_image']              = $status['special_prod']['home_image'];
                    $data['lang_id']                                = $this->config->get('config_language_id');
                    if(!empty($data['status_special_main_form'])){
                        $name           = "tvcmstabproducts";
                        $status_info    = $this->model_catalog_tvcmsmodule->getmoduelstatus($name);
                        $data_info      = json_decode($status_info['setting'],1);
                        
                        if(!empty($data['status_special_home_title'])){
                            $data['special_hometitle'] = $data_info['tvcmstabproducts_pro_special']['lang_text'][$data['lang_id']]['hometitle'];
                        }
                        if(!empty($data['status_special_home_sub_title'])){
                            $data['special_homesubtitle'] = $data_info['tvcmstabproducts_pro_special']['lang_text'][$data['lang_id']]['homesubtitle'];
                        }
                        if(!empty($data['status_special_home_description'])){
                            $data['special_homedes'] = $data_info['tvcmstabproducts_pro_special']['lang_text'][$data['lang_id']]['homedes'];
                        }
                        if(!empty($data['status_special_home_image'])){
                            $data['special_img'] = $data_info['tvcmstabproducts_pro_new']['lang_text'][$data['lang_id']]['img'];
                        }   
                    }
                }
                ]]></add>
        </operation> 
    </file>
    <file path="catalog/controller/common/home.php">
        <operation>
            <search><![CDATA[$data['header'] = $this->load->controller('common/header');]]></search>
            <add position="after"><![CDATA[
                $data['footer_top'] = $this->load->controller('common/footer_top');
            ]]></add>
        </operation> 
    </file>
    <file path="catalog/controller/extension/module/category.php">
        <operation>
            <search><![CDATA[$categories = $this->model_catalog_category->getCategories(0);]]></search>
            <add position="after"><![CDATA[foreach ($categories as $tvcmscategory) {
            $tvcmschildren_data = array();
            $children = $this->model_catalog_category->getCategories($tvcmscategory['category_id']);
            foreach($children as $child) {
                $filter_data = array('filter_category_id' => $child['category_id'], 'filter_sub_category' => true);
                $tvcmschildren_data[] = array(
                    'category_id' => $child['category_id'],
                    'name' => $child['name'] . ($this->config->get('config_product_count') ? ' (' . $this->model_catalog_product->getTotalProducts($filter_data) . ')' : ''),
                    'href' => $this->url->link('product/category', 'path=' . $tvcmscategory['category_id'] . '_' . $child['category_id'])
                );
            }
            $filter_data = array(
                'filter_category_id'  => $tvcmscategory['category_id'],
                'filter_sub_category' => true
            );
            $data['tvmcscategories'][] = array(
                'category_id' => $tvcmscategory['category_id'],
                'name'        => $tvcmscategory['name'] . ($this->config->get('config_product_count') ? ' (' . $this->model_catalog_product->getTotalProducts($filter_data) . ')' : ''),
                'children'    => $tvcmschildren_data,
                'href'        => $this->url->link('product/category', 'path=' . $tvcmscategory['category_id'])
            );
        }]]></add>
        </operation> 
             
    </file>
   <file path="catalog/controller/account/download.php">
        <operation>
            <search><![CDATA[new Pagination();]]></search>
            <add position="replace"><![CDATA[
                new Tvcmspagination();
            ]]></add>
        </operation>
    </file>
    <file path="catalog/controller/account/order.php">
        <operation>
            <search><![CDATA[new Pagination();]]></search>
            <add position="replace"><![CDATA[
                new Tvcmspagination();
            ]]></add>
        </operation>
    </file>
    <file path="catalog/controller/account/recurring.php">
        <operation>
            <search><![CDATA[new Pagination();]]></search>
            <add position="replace"><![CDATA[
                new Tvcmspagination();
            ]]></add>
        </operation>
    </file>
    <file path="catalog/controller/account/return.php">
        <operation>
            <search><![CDATA[new Pagination();]]></search>
            <add position="replace"><![CDATA[
                new Tvcmspagination();
            ]]></add>
        </operation>
    </file>
    <file path="catalog/controller/account/reward.php">
        <operation>
            <search><![CDATA[new Pagination();]]></search>
            <add position="replace"><![CDATA[
                new Tvcmspagination();
            ]]></add>
        </operation>
    </file>
    <file path="catalog/controller/account/transaction.php">
        <operation>
            <search><![CDATA[new Pagination();]]></search>
            <add position="replace"><![CDATA[
                new Tvcmspagination();
            ]]></add>
        </operation>
    </file>
    <file path="catalog/controller/extension/credit_card/sagepay_direct.php">
        <operation>
            <search><![CDATA[new Pagination();]]></search>
            <add position="replace"><![CDATA[
                new Tvcmspagination();
            ]]></add>
        </operation>
    </file>
    <file path="catalog/controller/extension/credit_card/sagepay_server.php">
        <operation>
            <search><![CDATA[new Pagination();]]></search>
            <add position="replace"><![CDATA[
                new Tvcmspagination();
            ]]></add>
        </operation>
    </file>
    <file path="catalog/controller/product/category.php">
        <operation>
            <search><![CDATA[new Pagination();]]></search>
            <add position="replace"><![CDATA[
                new Tvcmspagination();
            ]]></add>
        </operation>
    </file>
    <file path="catalog/controller/product/manufacturer.php">
        <operation>
            <search><![CDATA[new Pagination();]]></search>
            <add position="replace"><![CDATA[
                new Tvcmspagination();
            ]]></add>
        </operation>
    </file>
    <file path="catalog/controller/product/product.php">
        <operation>
            <search><![CDATA[new Pagination();]]></search>
            <add position="replace"><![CDATA[
                new Tvcmspagination();
            ]]></add>
        </operation>
    </file>
    <file path="catalog/controller/product/search.php">
        <operation>
            <search><![CDATA[new Pagination();]]></search>
            <add position="replace"><![CDATA[
                new Tvcmspagination();
            ]]></add>
        </operation>
    </file>
    <file path="catalog/controller/product/special.php">
        <operation>
            <search><![CDATA[new Pagination();]]></search>
            <add position="replace"><![CDATA[
                new Tvcmspagination();
            ]]></add>
        </operation>
    </file>
   
    <file path="system/library/response.php">
        <operation>
            <search><![CDATA[if ($this->output) {]]></search>
            <add position="before"><![CDATA[
                //speedup
                    if(!defined('HTTP_CATALOG')){
                        $config = $GLOBALS['registry']->get('config');
                        //echo "<pre>"; print_r($config->get('tvcmscustomsetting_configuration')['htmlminify']); echo "</pre>"; die;
                        $status = $config->get('tvcmscustomsetting_configuration')['htmlminify'];
                        if(!empty($status)){
                            $this->output = minify($this->output);
                        }
                    }
                //speedup
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[echo $output;]]></search>
            <add position="after" offset="3"><![CDATA[
                function minify($output = ''){
                    if(isset($GLOBALS['registry']) && !$GLOBALS['registry']->get('speedup')){
                        $speedup = new tvcmsminify($GLOBALS['registry']); 
                        $GLOBALS['registry']->set('speedup', $speedup);
                    }
                    if($GLOBALS['registry']->get('speedup'))
                        return $GLOBALS['registry']->get('speedup')->minify_html($output);
                    return $output;
                }
            ]]></add>
        </operation> 
    </file>

</modification>